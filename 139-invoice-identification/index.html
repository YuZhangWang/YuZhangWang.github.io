<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>增值税发票自动识别 | YuZhangWang的领域</title><meta name="author" content="YuZhangWang"><meta name="copyright" content="YuZhangWang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="绪论课题的研究背景及意义增值税专用发票是商业的行政单据[1]，由于实现凭开具收据对购进费用扣税，而进货方要向商品销售方交纳所得税，所以它是完税单据，同时具备对商品销售方的税法义务和购物方进款税金的法律证实的意义，是有效所得税普征性和公平性的体现。因此，增值税发票的两大功能为交易凭据功能和缴税凭据功能。伴随着正在迅发展的科技水平和我国经济情况，在普通的日常生活中，增值税发票的投入使用，成为了不可避免">
<meta property="og:type" content="article">
<meta property="og:title" content="增值税发票自动识别">
<meta property="og:url" content="https://yuzhang.wang/139-invoice-identification/index.html">
<meta property="og:site_name" content="YuZhangWang的领域">
<meta property="og:description" content="绪论课题的研究背景及意义增值税专用发票是商业的行政单据[1]，由于实现凭开具收据对购进费用扣税，而进货方要向商品销售方交纳所得税，所以它是完税单据，同时具备对商品销售方的税法义务和购物方进款税金的法律证实的意义，是有效所得税普征性和公平性的体现。因此，增值税发票的两大功能为交易凭据功能和缴税凭据功能。伴随着正在迅发展的科技水平和我国经济情况，在普通的日常生活中，增值税发票的投入使用，成为了不可避免">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131534293.png">
<meta property="article:published_time" content="2023-09-13T00:08:08.000Z">
<meta property="article:modified_time" content="2023-09-13T08:57:53.631Z">
<meta property="article:author" content="YuZhangWang">
<meta property="article:tag" content="CRNN">
<meta property="article:tag" content="CTPN">
<meta property="article:tag" content="增值税发票">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131534293.png"><link rel="shortcut icon" href="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202210171416164.png"><link rel="canonical" href="https://yuzhang.wang/139-invoice-identification/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?2ed9ec904657094072d5645542b35a76";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"距离上次更新已经过去","messageNext":"天,文章内容可能与实际操作有一定出入"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":500,"languages":{"author":"作者: YuZhangWang","link":"链接: ","source":"来源: YuZhangWang的领域","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#49b1f5","position":"top-center"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '增值税发票自动识别',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-13 16:57:53'
}</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/Align-al-elements.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss2.xml" title="YuZhangWang的领域" type="application/rss+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202210171416164.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">139</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">288</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/cinemas/"><i class="fa-fw fa fa-film"></i><span> 影视</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fab fa-youtube"></i><span> 番剧</span></a></div><div class="menus_item"><a class="site-page" href="/natter/"><i class="fa-fw fa-sharp fa-solid fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/albums/"><i class="fa-fw fa fa-camera"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/project/"><i class="fa-fw fa fa-coins"></i><span> 项目</span></a></div><div class="menus_item"><a class="site-page" href="/cv/"><i class="fa-fw fa-solid fa-file"></i><span> 简历</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-solid fa-thumbs-up"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202210171416164.png" alt="Logo"><span class="site-name">YuZhangWang的领域</span></a><a class="nav-page-title" href="/"><span class="site-name">增值税发票自动识别</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/cinemas/"><i class="fa-fw fa fa-film"></i><span> 影视</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fab fa-youtube"></i><span> 番剧</span></a></div><div class="menus_item"><a class="site-page" href="/natter/"><i class="fa-fw fa-sharp fa-solid fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/albums/"><i class="fa-fw fa fa-camera"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/project/"><i class="fa-fw fa fa-coins"></i><span> 项目</span></a></div><div class="menus_item"><a class="site-page" href="/cv/"><i class="fa-fw fa-solid fa-file"></i><span> 简历</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-solid fa-thumbs-up"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">增值税发票自动识别</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon fas fa-history"></i><span class="post-meta-label">更新于</span><time datetime="2023-09-13T08:57:53.631Z" title="更新于 2023-09-13 16:57:53">2023-09-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E8%83%BD%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">技能学习记录</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E5%B1%95%E7%A4%BA/">项目展示</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Python学习笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">11.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>35分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="绪论"><a href="#绪论" class="headerlink" title="绪论"></a>绪论</h1><h2 id="课题的研究背景及意义"><a href="#课题的研究背景及意义" class="headerlink" title="课题的研究背景及意义"></a>课题的研究背景及意义</h2><p>增值税专用发票是商业的行政单据<sup>[1]</sup>，由于实现凭开具收据对购进费用扣税，而进货方要向商品销售方交纳所得税，所以它是完税单据，同时具备对商品销售方的税法义务和购物方进款税金的法律证实的意义，是有效所得税普征性和公平性的体现。因此，增值税发票的两大功能为交易凭据功能和缴税凭据功能。伴随着正在迅发展的科技水平和我国经济情况，在普通的日常生活中，增值税发票的投入使用，成为了不可避免的一个环节，对于增值税发票的需求越来越多。作为普通情况下，收据的一个不可缺少的部分，增值税发票包含的信息，涵盖了以下的几个方面：发票应用代码、花费所产生的金额、购买商品的数量、商品的价格、一张发票的号码、不同纳税人不同的识别号等，下图中显示的增值税发票为一般形式:</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131534293.png" alt="图1.1 增值税发票图像"></p>
<p>在当前移动互联网快速发展的大环境下，增值税发票识别成为一个比较热门而有价值的应用方向<sup>[2]</sup>。并且伴随着社会信用体系不断完善，增值税发票已经成为人们主流的交易证明。在工商业和农业制造技术、现代应用科学技术、军事领域科学科技、医疗领域识别技术等领域<sup>[3]</sup>，逐渐涌入了大量使用图像信息识别这一技术的人们，尝试以此来认知识别和评判估计一系列的事件，并根据所产生的结果，来处理解决现实生活中会遇到的实际问题，在此环境条件下如何高效有序地对增值税发票进行智能化管理，是对当下智能票据提出的一个硬性要求。发票号码作为发票唯一的身份标识，常用作支付交易证明和经费报销申请的主要依据，所以针对发票识别技术(Invoice Recognition Technology，IRT)，从传统的机器学习到当下的深度学习都在不断地进行着算法的更新与迭代。这样在当今信息科技高速发展的年代，数以万计的人们对于增值税发票识别的信息处理技术产生了更加深入的要求，人们希望识别的信息处理技术能够较为迅速且兼顾一定的精确，来检测识别索引出人们所需要的一系列图像或文字信息。</p>
<p>目前，CVPR、ICCV、ECCV等全球顶尖学术会议中<sup>[4]</sup>，已把现场文字检查与鉴别技术作为其研究重点专题之一<sup>[5]</sup>，字检查与识别技术广泛使用于图像识别方面，是当前科学研究的前沿问题。而现场图像识别技术(Scene Text Recognition，STR)是在某种复杂情形下将图形输入并翻译成自然语言的，需要同时包含文字检查与图像识别二种过程，通过文字检查即发现了图像的地址与区域，通过图像识别即将文字区域信息转换为文字信号。图像识别技术对于人们而言是十分富有挑战性的技术，虽然目前图像识别技术发展缓慢，但是人们仍然希望将实现技术普遍运用到日常生活中的各个方面，并不断地在为之努力着<sup>[6]</sup>。因为文字辨识技术发展不仅促进了其他科学技术的进展，并且文字判辩识别技术的进步空间十分宽广，能否于的应用领域也十分广阔，其中光学字符识别(Optical CharacterRecognition，OCR)的辨识技术在文字辨识领域中是项关键性科技。</p>
<p>发票识别检测的主要目的是从复杂的发票布局环境中检测出发票的有效区域。通过Sobel算子进行发票边缘检测 。在步入二十一世纪以后，由于电脑计算能力技术进行了很大的提高，深层神经网络和电脑视觉信息技术也开始运用在了发票文字信息检索之中，其中比较成熟的是基于卷积递归神经网络(Convolutional Recurrent Neural Network，CRNN)和链接主义的文字建议系统(Connectionist Text Proposal Network，CTPN)<sup>[7]</sup>实现的算法。</p>
<p>一般的发票识别技术是由预处理和图像输入构成的，预处理技术包括了灰度化和二值化及图象修改更正，以及消除噪声等等，而图像则是，应对不同情况下的的压缩技术，提供了不同情况的存储技术。而对于怎样判断出发票的识别性能好和差的指标分析，则涵盖了产品的误识性、识别速度、可行性、可靠性和易用性等多个不同的方面问题，并通过运用一些辅助工具数据信息能够进一步提高鉴别的准确度等，这在发票的实际应用上是十分关键的。简单的来说是先将文本转化成图像信息，而后再运用字符识别技术把图形的一系列信息来转换成符合应用方面的输入技术。然后再依据发票鉴别判定识别的产生结果来进行对应的分析，并通过智能纠正错误信息系统。随着我国的科学技术发展得愈来愈好，发票识别技术也被广泛使用开来。</p>
<p>在现实应用中，发票文本的检查和鉴别工作通常串联在-起，能同时检查到文本位置并对其加以鉴别的方式，被称之为”端到端”文本辨识方式。但是由于在中文场景中往往存在着背景干涉、图片朦胧、文字遮蔽等一系列的复杂情况，所以在中文场景文本鉴别上也面临了更多的挑战，由于各种类型的发票开具所提供的文字图片尺寸、颜色等所给出的条件均截然不同，因此在本文识别情况下，最先使用的技术就是分类，以确定发票所提供的类型，这样对于如车票、小票等，这些文字元素和图片元素固定的发票依据所给出的不同信息，就可以利用已固化的特征模板，从而来截取出，即将需要进行识别信息中的所有文字和图片，同样的，这一举措，也同步大大减弱了之后识别步骤的难度。而接下来，面对增值税这些机器打印形成的图片和文字，而随着机器的转子速度不同而发生变化的发票，将引入采用文字图像增强的二次分割法，并完成文字截取，并完成倾斜校对。这既减少了辨认困难，也增加了发票辨认的准确性。</p>
<p>目前，文本检索方式一般分为根据文本内容选框回归的类别、依据划分的回归样式以及其划分和回归样式组合的方式。尽管在最近的几年中，源于深度学习的文本字符测试识别技术逐渐取获得了伟大进步，但文本字符作为具备其独特拥有特征的一个目标对象，其文字构成结构、不同色彩、不同方向、不同大小等至今依旧会呈现出多元形态样式，所以针对于普遍的目标测试技术，实现起来仍旧较为困难。假设一个已经在大数据集上产生了十分不错的效果的模型，将该模型投入应用于另外的大数据集上的效果也并不能达到我们需要的效果，甚至说情况是非常糟糕的。由于大多数模型都是通过某项数集来调整系数或进行进一步调整的，并且由于其极大依赖于实验数据，在充分了解后也并不能获得实质性的认识，所以该课题很值得深入研究。神经网络模型在文本测量方面也已经有了研究，如区域建议网络(Region Proposal Network，RPN)，如果仅仅使用RPN的技术来测量文本，那么很难十分准确地实现水平测量的效果。RPN的方法是通过训练来直接定位图象中的文字行为，不过利用文本行为来估计图象中的文字发生错误的可行性较大，因为文字是一种缺乏明显的封闭边界的序列。值得高兴的是，Anchor回归机制的发明使得RPN能够通过单尺寸窗口测量更多尺寸的对象，这种思想的核心内容就是通过使用些灵活的Anchors在大尺寸和纵横比的区域里对物体大小作出估计。其研究结果，通过CTPN方法，构建了增值税发票的文字检验神经网络模式，可以更精确地对增值税发票的文本内容进行全水平检验。</p>
<h2 id="OCR研究进展"><a href="#OCR研究进展" class="headerlink" title="OCR研究进展"></a>OCR研究进展</h2><p>光学字符识别(Optical Character Recognition，OCR)是模型辨识技能中的一种旁支，目的是在图片处理过程中的信息进行光学处理，提取并直接输出图像的所有文本信息。如今的OCR包括传统的OCR和场景文本识别(Scene Text Recognition，STR)<sup>[8]</sup>，这两种识别技术中使用的内容，涵盖了所有的文本字符信息检测技术和识别技术。现有的OCR分为三种方法：</p>
<ul>
<li><p>(1) 文本字符检验测试识别方法，作用于检测识别和定位确定图像中需要识别文本的位置。</p>
</li>
<li><p>(2) 识别方法，将检测到的文本区域转换成语言符号。</p>
</li>
<li><p>(3) 可以进行文本检测和识别的端到端方法<sup>[9]</sup>。</p>
</li>
</ul>
<h3 id="文本检测方法"><a href="#文本检测方法" class="headerlink" title="文本检测方法"></a>文本检测方法</h3><p>文本检测是文本识别首先要做的一步，要让机器识别自然场景中获取的文本信息，要先让机器知道文本信息的位置。现在也有很多文本检测的解决方案，但是在面对复杂的图像时，往往抗干扰能力不尽如人意。而且这些图像通常会有不同字体（例如艺术文字），不同形状，严重影响了文本的检测与识别。</p>
<h3 id="文本识别方法"><a href="#文本识别方法" class="headerlink" title="文本识别方法"></a>文本识别方法</h3><p>机器获取文本位置以及形状后，就要开始主要工作文本识别。在近期以来，世界范围内的各界人士，都已经见识到了神经网络的强大力量和它进行的巨大复兴，这最先需要提及的，是在深层神经网络模式的基础上，特别是深度卷积神经网络(Diffusion Convolutional Recurrent Neural Network，DCNN)在各种视觉应用上的巨大成功所带来的。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131543003.png" alt="图1.2 文字识别结果图"></p>
<p>在实际中，场景文本通常以递次的情况出现，而不是单独地呈现。和常规的标识有所不同，标识这些相关系列的对象一般都必须系统地预测一些对象标志。所以，这些目标的辨识可能被认为是顺序辨识问题。</p>
<h3 id="端到端的方法"><a href="#端到端的方法" class="headerlink" title="端到端的方法"></a>端到端的方法</h3><p>端到端的方法，在进行模拟练习时需要使用检测功能的识别模块，从而利用最终的识别结果提高整个模型的精度。一部分模型，比如统一网络的快速定向文本搜索(Fast OrientedText Spotting With A Unified Network，FOTS)和明确对齐和关注的 “端到端 “的文本挖掘器(And-to-end Textspotter With Explicit Alignment And Attention，EAA)，连接了流行的文本检测和文本识别方法，并用一个损失函数统一训练它们。掩膜文本观测器（Mask Text Spotter，MTS）<sup>[10]</sup>利用设计的模型，将文本识别转换为了一个语义分割问题。</p>
<h2 id="论文的主要内容及结构安排"><a href="#论文的主要内容及结构安排" class="headerlink" title="论文的主要内容及结构安排"></a>论文的主要内容及结构安排</h2><p>本文主要内容为基于深度学习的增值税发票自动识别。本文第一章为绪论，介绍了增值税发票自动识别的课题背景；第二章介绍现在应用的文字检测和文字识别相关技术；第三章分析增值税发票自动识别系统的需求并进行总体的设计；第四章为实验过程及结果。</p>
<h1 id="相关理论及技术介绍"><a href="#相关理论及技术介绍" class="headerlink" title="相关理论及技术介绍"></a>相关理论及技术介绍</h1><h2 id="卷积神经网络"><a href="#卷积神经网络" class="headerlink" title="卷积神经网络"></a>卷积神经网络</h2><p>人工神经网络(Artificial Neural Networks，ANN)是一个采用模拟仿真传统生物学情况下的人体神经系统活动而进行构造的一个网络，以实现分布式网络并行数据处理的统计数学模型。ANN系统通过调整人体内神经元和神经元之间的权重关系，从而达到了处理信号的效果目的。而作为一种十分典型的前馈神经网络的卷积神经网络(Convolutional Neural Network，CNN)，其架构主要由若干户卷积运算层和池化层所组成，特别在影像数据处理方面以CNN中的特点体现得最为明显。</p>
<p>一个CNN的最本质的组成是由全接口层、一个输出层、池化式层(pooling layer，也称作取样层)、入口输入层、再加上卷积式层(convolutional layer)等拼接组合而成。逐点卷积方法计算层与池化层之间的连结方法通常均是若干个，因而选择了逐点卷积方法计算层与池化层之间的连结方法，也就是每一个逐点卷积方法计算层需要最先连结一个池化式层，之后每一个逐点卷积方法计算层再被一个池化层连接而成。即由于一定的局部或整体联系，在卷积法计算层内的特征图的所有神经元均与其输入发生，并通过相应的连接权数对该部分系统数值完成了加权求和之后再乘以偏置值，因此获得了该神经元的全部数据，这种步骤也就等同于了卷积步骤，CNN就因此而命名。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131545067.png" alt="图2.1  卷积神经网络的结构"></p>
<h2 id="循环神经网络"><a href="#循环神经网络" class="headerlink" title="循环神经网络"></a>循环神经网络</h2><p>循环神经网络(Recurrent Neural Network，RNN)主要有以下3方面的优点：</p>
<ul>
<li><p>（1）RNN有强大的捕获序列和历史数据的特征。相对独立的每一条序列，可以通过上下文进行比较处理更有优势。</p>
</li>
<li><p>（2）RNN可以和 CNN组成一个端到端的整体模型，通过误差反传一起进行训练。</p>
</li>
<li><p>（3）RNN不受序列长度的限制，可以对任意长度的序列进行处理。</p>
</li>
</ul>
<p>长短期记忆(Long short-term memory，LSTM)是一种属于十分特别的特殊RNN，由于阶梯消失问题和阶梯破坏问题较为严重，于是针对于长序列训练中的这些问题，而提出并实现长短期形式记忆。简单而言，即是在和普通的RNN对比过程中，LSTM可以在更多序列中产生比较好的结果呈现。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131545421.png" alt="图2.2  LSTM结构图"></p>
<h2 id="CTPN神经网络简介"><a href="#CTPN神经网络简介" class="headerlink" title="CTPN神经网络简介"></a>CTPN神经网络简介</h2><p>CTPN的神经式网络运行模块，一般情况下会包含以下这三个部分：单卷积方法的计算层、双向的长短期记忆层以及一个全连接层。底层利用VGG16的提供特性，可以使用下一个<img src="file:///C:\Users\YUZHAN~1\AppData\Local\Temp\ksohtml23028\wps1.png" alt="">类型长宽高比例的conv5的特征图feature map，一个长宽比为3×3的空间视窗<sup>[11]</sup>，并在完成一次卷积计算(VGG16 的conv5)的feature map上滑动视窗。不同行中的顺序视窗之间通过双向长短期记忆神经网络 (bi - directional long short - termmemory，BLSTM)循环连接，并且每一个视窗的卷积特性(3×3×C)作为BLSTM 的输入入口，再进行双向BLSTM，以此达到对相互关系的序列的信息理解与学习过程，并利用VGG将最后一卷积层提供出来的feature map 转换为向量的类型，来作用于接下来的BLSTM训练场景。紧接着将 BLSTM的输出出口再输入至FC中，最终模型提供：2k个anchor 的文本/非文本分数、2h个y坐标、h个side_refinement(侧向细化偏移量)<sup>[12]</sup>。根据该模式而设计的CTPN神经网络模式，如图2.3所示。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131546426.png" alt="图2.3  CTPN神经网络模型"></p>
<p>原始的CTPN系统只检测以横向顺序排列的文字。CTPN结构形式和FasteR R-CNN<sup>[13]</sup>结构形式的基本类型相同，只不过在基础上增加了LSTM层的这个环节。</p>
<p>假设输入Image：</p>
<p>首先从VGG<sup>[14]</sup>中提取特征，可以得到大小尺寸为的 $N \times C \times H \times W$ 的conv5 feature map这个特征图。</p>
<p>之后在conv5有长宽比例为$3 \times 3$的滑动视窗，也就是将各个节点都根据周围尺寸为$3 \times 3$的地域特点，而得到了一条直径为$3 \times 3 \times C$ 的特征矢量。对于输出的$N \times 9C \times H \times W$ 的feature map，这些特性显然是可以通过CNN了解到的空间特征。</p>
<p>再将这个feature map进行Reshape，</p>
<script type="math/tex; mode=display">Reshape:N \times 9C \times H \times W \rightarrow (NH)\times W \times 9C \qquad  \qquad (2-1)</script><p>然后，将所有的以$Batch=NH$ 且最大时长$T_{max}=W$ 的数据信息流进入双向LSTM<sup>[16]</sup>，并了解每条行的顺序特点。经过双向LSTM输出$(NH) \times W \times 256$ 之后，再经Reshape回复原来状态：</p>
<script type="math/tex; mode=display">Reshape:(NH) \times W \times 256 \rightarrow N\times 256 \times H \times W \qquad  \qquad (2-2)</script><p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131601768.png" alt="图2.4  CTPN网络结构"></p>
<h2 id="CRNN端到端的识别"><a href="#CRNN端到端的识别" class="headerlink" title="CRNN端到端的识别"></a>CRNN端到端的识别</h2><p>本文选取了卷积递归神经网络(Convolutional Recurrent Neural Network，CRNN)作为识别模型(主要由CTC、CNN、RNN构成)，在使用该模型的情况下，能够进行识别出不定长的文本序列。作用于具体的应用阶段的时候，CNN则进行文本字符图像的特征提取工作，而RNN则依据Bi-LSTM来进行融合特征向量工作，再进行提取文本字符序列特征这一工作，最后通过CTC这一转录层来输出不同序列的概率分布情况，借此来预测最优的文本序列值。另外，由于CRNN摒弃了在传统神经网络中采用的完全连接的方法，所以也产生了更为紧凑和合理的模型。所有的这些特征，使得CRNN成为了基于图像的序列辨识的最好方式。</p>
<h3 id="CRNN的优点"><a href="#CRNN的优点" class="headerlink" title="CRNN的优点"></a>CRNN的优点</h3><p>CRNN的网络结构是专门为解决图像中的序列而设计的。因为将CNN和RNN进行了结合，CRNN有以下几个优点:</p>
<ul>
<li><p>（1）相对于CNN，能够实现在序列数据中直接进行学习功能，与CNN对比者不需要较为细致的字符级的位置标注这一内容。</p>
</li>
<li><p>（2）本该进行预处理的CRNN的图像数据，不需要在输入到其中的时候进行处理，也不需要进行手工的特征提取，就可以从图像中直接学习到相关的特征。</p>
</li>
<li><p>（3）CRNN因为含有RNN，可以捕获图像特征序列中上下文的依赖。</p>
</li>
</ul>
<h3 id="CRNN的网络结构"><a href="#CRNN的网络结构" class="headerlink" title="CRNN的网络结构"></a>CRNN的网络结构</h3><p>如图显示，CRNN的网络模式，CRNN由三个部分构成，包含最常用的卷积层、循环层以及翻译层。CRNN主要提出了在文字识别中是对文字序列加以预测的思路，它首先利用了CNN技术将文字图像的特点加以提炼，而后再利用RNN网络对其特征加以文字序列预测，最后再利用了CTC损失函数的翻译层，得出了最终的结论。CRNN虽然由各种网络结构所形成，但依然可根据每一种损失函数加以系统训练。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131603230.png" alt="图2.5  CRNN网络结构示意图"></p>
<p>特征提取，正常的图像采集，所获取到的特征通常以序列方法传递。</p>
<p>BLSTM，特征输入到BLSTM，输出每个序列代表的值（这个值是一个序列，代表可能出现的值），对输出进行softmax操作，等于每个可能出现值的概率。</p>
<p>CTC，是一个LOSS，一个从概率到实际输出的概率。</p>
<p>CRNN的创新之处就是可以通过双向BLSTM来获取图像特征信息，对序列特征识别效应更显而易见。以及把语言识别领域的CTC-LOSS导入图像，这是质的突破。</p>
<p>在文本识别基础上的试验证明了，和传统方法或其他基于CNN和RNN的算法比较，CRNN方法拥有着卓越并具有竞争性的特点。</p>
<h3 id="CTC模型"><a href="#CTC模型" class="headerlink" title="CTC模型"></a>CTC模型</h3><p>CTC模型<sup>[16]</sup>。连接时间分级法(Connectionist Temporal Classification，CTC)也叫连结主义时间划分，主要用于处理进入顺序与产出顺序之间无法一一对接的提问。通过CTC，可以将循环层生成的每帧预期结果概率值转换成标签顺序，之后再开始执行输出，使进入顺序与产出顺序更加平整完善。在此模式上，CTC可视为依据输入的每帧预测信息，找出带有最大概率值的标签顺序并执行输出。因此CTC的损失函数应该界定为:</p>
<script type="math/tex; mode=display">L(S)=-ln\prod_{(x,z) \in S} p(z|x)=-\sum_{(x,z) \in S} lnP(z|x) \qquad  \qquad (2-3)</script><h1 id="系统分析及总体设计"><a href="#系统分析及总体设计" class="headerlink" title="系统分析及总体设计"></a>系统分析及总体设计</h1><h2 id="增值税发票自动识别系统分析"><a href="#增值税发票自动识别系统分析" class="headerlink" title="增值税发票自动识别系统分析"></a>增值税发票自动识别系统分析</h2><p>由于最新的深度学习卷积式神经网络技术，在许多电脑视觉任务中的性能已超越了传统方式，尝试在发票系统中使用神经网络模型替换传统的算法完成目标区域定位任务，为了更好满足比传统算法更好在检测速度与检测精度之间作更好的平衡，且相对于传统图像匹配算法具有更好的鲁棒性。本项目在传统的CNN和RNN中，引入了CTPN和CRNN技术，通过更加深层的神经网络和预测识别，来实现针对于增值税发票场景下文字的识别。</p>
<h2 id="增值税发票自动识别算法设计"><a href="#增值税发票自动识别算法设计" class="headerlink" title="增值税发票自动识别算法设计"></a>增值税发票自动识别算法设计</h2><p>本项目根据增值税发票版面的一些固定特有的特点，从而构思设计出对于数据对象类的一系列识别算法流程，算法流程设计过程如下图所示：</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131618172.png" alt="图3.1  识别工作流程图"></p>
<h3 id="系统环境配置"><a href="#系统环境配置" class="headerlink" title="系统环境配置"></a>系统环境配置</h3><p>在该项目中，我们使用是是Windows系统、Pytorch、Cuda、Python的组合。首先我们需要将环境配置成功，才能为我们需要的项目，提供一个良好可以运行的稳定环境，以此来进行接下来我们需要进行的文本字符识别、数据集采集工作、文本字符训练工作、文本字符运行等等的工作。以下为项目详细数据。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">项目</th>
<th style="text-align:center">参数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">操作系统</td>
<td style="text-align:center">Windows 11 专业版 21H2</td>
</tr>
<tr>
<td style="text-align:center">CPU</td>
<td style="text-align:center">AMD Ryzen 7 5800H</td>
</tr>
<tr>
<td style="text-align:center">GPU</td>
<td style="text-align:center">NVIDIA GeForce RTX 3060</td>
</tr>
<tr>
<td style="text-align:center">RAM</td>
<td style="text-align:center">32G</td>
</tr>
<tr>
<td style="text-align:center">深度学习框架</td>
<td style="text-align:center">Pytorch1.10.1 + Cuda11.1</td>
</tr>
<tr>
<td style="text-align:center">编程语言</td>
<td style="text-align:center">Python3.9</td>
</tr>
</tbody>
</table>
</div>
<div align="center">表3.1 系统环境配置</div>


<p>首先，该项目使用Python编写完成，所以我们需要在我们的电脑上搭建一个Python的运行环境，在这里我们采用较为新的Python3.7版本。之后项目运行环境，我们可以根据Anaconda进行虚拟环境的设置，但是前提是操作系统需要一个Python环境，所以我们需要进行下载。采用3.7是因为这个版本较为稳定。</p>
<p>在这里，我们需要访问Python文件提供的官网，来进行下载。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131623532.png" alt="图3.2   Python3.7.4"></p>
<p>因为我们的操作系统是64位的，所以我们需要下载64位的Python3.7才行。然后根据文件提示，我们一步步进行安装即可。</p>
<p>然后进入终端进行查询，我们可以看到，Python3.7.4已经安装完成。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131624872.png" alt="图3.3  查看Python版本"></p>
<p>然后是Anaconda的安装和部署，这里一开始和Python安装一样需要去下载文件。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131624847.png" alt="图3.4  Conda下载"></p>
<p>在这里，由于外网访问的限制，所以我们通过访问清华的开源镜像网站来进行下载。</p>
<p>同样我们需要跟着安装文件的提示来进行安装，最后在终端中进行查询是否安装成功。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131625230.png" alt="图3.5  查看Conda版本"></p>
<p>然后我们需要安装对应的Cuda文件，我们才可以调用我们的显卡，来进行数据集的训练工作。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131625457.png" alt="图3.6  Cuda安装程序"></p>
<p>我们将文件安装在默认位置即可。安装完成之后进行查看时候安装成功。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131626919.png" alt="图3.7 查看Cuda版本"></p>
<p>然后是Conda环境的激活配置。</p>
<p>首先我们需要查看一下显卡的驱动版本，这里可以看到驱动的版本为10.2.89，符合Conda和Pytorch的要求，可以在此环境下运行。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131626571.png" alt="图3.8  Cuda驱动版本"></p>
<p>然后进行环境的激活，可以看到，这里显示环境激活失败。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131627151.png" alt="图3.9  环境激活"></p>
<p>寻找原因之后，发现是软件包的数据源出现了问题，因此我们需要将数据源进行替换，这里我是用清华的开源镜像网站进行替换。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131629901.png" alt="图3.10  替换镜像源"></p>
<p>然后进行环境的创建，可以看到，此时环境创建工作在正常运行。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131629937.png" alt="图3.11  创建环境"></p>
<p>这里会将需要的一些依赖库进行导入，为创建环境提供基础包。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131629907.png" alt="图3.12  导包"></p>
<p>可以看到提示，Pytorch1.7的Conda环境已经创建成功，然后即可进行激活，可以看到，开头变成了Pytorch1.7，着代表已经进入到这个环境当中。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131630435.png" alt="图3.13  环境激活"></p>
<p>然后需要安装Tor和Cuda适配的版本，但是此处安装结果显示为失败。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131630748.png" alt="图3.14  安装结果"></p>
<p>经过判断，可以发现问题来源于下载包Tor版本和Cuda版本不对应，导致适配问题一直出现，所以此时根据版本的对应关系，需要下载正确的包，并进行安装。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131631647.png" alt="图3.15 下载正确包"></p>
<p>这里两者关系对应存在一些问题，所以Pytorch1.7版本也需要进行对应更换，这里将版本替换成1.10版，随后在Pycharm中，选择解释器为新创建的Pytorch环境。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131631308.png" alt="图3.16 选择新建框架"></p>
<p>在选择完成之后，进行等待，等待后台Python解释器更新完成，并且生成框架索引。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131631675.png" alt="图3.17 更新解释器"></p>
<p>更新之后，进行测试，发现还有没有安装成功。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131632715.png" alt="图3.18 库未安装"></p>
<p>此时需要进入终端，并且输入activate pytorch2来激活新创建的环境，进入到这个创建的虚拟框架当中。进入之后，输入pip install opencv-python来导入缺失的包。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131632615.png" alt="图3.19 导入缺失的库"></p>
<p>在进行测试的时候，可以看到，下方Python解释器成功导入，并且框架也正在导入。运行测试之后，也能正常运行起来。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131633682.png" alt="图3.20 解释器导入"></p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131634928.png" alt="图3.21 测试成功"></p>
<h3 id="数据集加载"><a href="#数据集加载" class="headerlink" title="数据集加载"></a>数据集加载</h3><p>数据集的选取，可以说十分重要了。一个好的模型训练，需要大量的数据集，这些数据集不仅在数量上需要要多，同时也要求，从多方面、多角度、多个形态样式来选取数据集，这样可以保证数据集在训练的时候，能够尽可能完善地训练出我们需要的模型来。</p>
<p>项目需要选取一个有效的数据集，而开源平台提供了一系列的数据集，这里选取的Pascal VOC挑战赛所使用的数据集，用于构造建立和评判估计文字分割、文字对象检测和图像分类的算法。但是由于其官网一直处于关闭的状态，所以我们需要访问镜像网站来获取其资源。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131634657.png" alt="图3.22  VOC2007数据集"></p>
<p>这里需要的是数据集中的图片和坐标数据，其中图片信息如下，是一系列日常生活中的照片，一共是5011张，一般数据集的选取，在2000个至10000个左右合适，5011张正好在此区间内，因此适合用作数据集。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131635730.png" alt="图3.23  数据集图像"></p>
<p>另外一个需要的是图像的坐标文件。例如一张带有椅子的图片，它的数据坐标中就包含了数据来源信息，长度高度和深度信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;source&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;database&gt;The VOC2007 Database&lt;/database&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;annotation&gt;PASCAL VOC2007&lt;/annotation&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;image&gt;flickr&lt;/image&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;flickrid&gt;<span class="number">325991873</span>&lt;/flickrid&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;/source&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;size&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;width&gt;<span class="number">500</span>&lt;/width&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;height&gt;<span class="number">375</span>&lt;/height&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;depth&gt;<span class="number">3</span>&lt;/depth&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;/size&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;segmented&gt;<span class="number">0</span>&lt;/segmented&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;<span class="built_in">object</span>&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;name&gt;chair&lt;/name&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;pose&gt;Rear&lt;/pose&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;truncated&gt;<span class="number">0</span>&lt;/truncated&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;difficult&gt;<span class="number">0</span>&lt;/difficult&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;bndbox&gt;  </span><br><span class="line">        &lt;xmin&gt;<span class="number">263</span>&lt;/xmin&gt;  </span><br><span class="line">  </span><br><span class="line">        &lt;ymin&gt;<span class="number">211</span>&lt;/ymin&gt;  </span><br><span class="line">  </span><br><span class="line">        &lt;xmax&gt;<span class="number">324</span>&lt;/xmax&gt;  </span><br><span class="line">  </span><br><span class="line">        &lt;ymax&gt;<span class="number">339</span>&lt;/ymax&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;/bndbox&gt;  </span><br><span class="line">  </span><br><span class="line">&lt;/<span class="built_in">object</span>&gt;</span><br></pre></td></tr></table></figure>
<p>例如以上为第五张图片的部分坐标信息，从这里可以读出。首先，数据集来源为VOC大赛提供的开源数据集，图片的验证id信息。其次是宽度、高度和深度，例如这里的宽度为500、高度为375，深度为3。然后就是椅子的位置信息，这里是将图片类比于一个框，距离边框的大小，来确定椅子大概可能出现的区域，对其做出一个预测。</p>
<p>在代码中体现为，设定两个元素，img_dir和xml_dir来存放数据集的存储地址，如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">img_dir = os.path.join(base_dir, <span class="string">&#x27;D:/Code/Python/invoice/VOC2007/JPEGImages&#x27;</span>)  <span class="comment"># VOC数据集路径</span></span><br><span class="line"></span><br><span class="line">xml_dir = os.path.join(base_dir, <span class="string">&#x27;D:/Code/Python/invoice/VOC2007/Annotations&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="文字检测网络"><a href="#文字检测网络" class="headerlink" title="文字检测网络"></a>文字检测网络</h3><p>对于一个OCR识别的项目来说，能做到提取图像中的文字，并转换为文本形式，以供后续任务使用。从图像中提取文本分成了两个部分，一个部分是检测文字所在的位置，另一个部分是识别文本区域内容。检测文字所在的位置就是CTPN，实际上文本检测也属于物品检测，只不过文本和常规的物体有着较大的区别，再加上增值税发票较为复杂的情况，所以文本检测相对于一般的检测来说，较为复杂。</p>
<p>CTPN网路架构可以分成，进行VGG特征提取；LSTM融入上下文信息，这一步是为了进行信息的预测，比较强调时序的问题；基于RPN完成检测。</p>
<p>首先要解决前景和背景的二分类问题，一个VGG提取模块，将原本的一个图片，分成不同层次，再进行池化操作，再经过了一定次数，例如64次之后，特征图中一个像素对应原始输入的多个像素。例如16个。</p>
<p>然后是ANchor大小选择问题，由于是文本，因此此时宽度是需要固定的，而长度是可以进行自由选择的，例如这里选择10个像素作为宽度展现。</p>
<p>在输出的结果中包括了2k得分、2k回归和1k边界调整。其中边界调整能使得文本检测框效果更好。</p>
<p>CTPN网络检测到的每一个小块文本区域还需要拼接成完整的文本区域。因此需要建立一个规则，分前向和后向两部分，前向向前走，对于Xi，基于重合度与位置距离的一定像素点找到Score值，也就是最大的$Xj$值，接下来再往回进行检测，检测规则依旧不变，比较两次得分值大小以此来判断序列。</p>
<h3 id="文字识别网络"><a href="#文字识别网络" class="headerlink" title="文字识别网络"></a>文字识别网络</h3><p>CRNN是文字识别的一个经典模型，它是一种卷积式的循环型神经网络结构，图像的序列识别情况比较适合用这个算法模型来解决，尤其是场景文本字符识别，因此发票识别采用此种算法较为适合。</p>
<p>CRNN实现分成了几个部分，我们一个个来进行说明，最先需要说明的是卷积层，也就是CNN，在这一层中，特征信息是所需要的，需要使用一定的方法将其提取出来，然后需要将其进行表示，表示为特征向量。之后就是循环层这样层的工作，这里的循环层是Bi-LSTM，是将其提取到的信息放入一堆RNN中，每个特征序列都是由双向LSTM从识别特征向量中组合而成，在此之后，那么关于特征向量的概率分布也可以因此得出。接着是转录层CTC，在这里，需要将RNN的输出转换成字符串序列。</p>
<p>卷积层的工作，首先将所有输入的图片Resize之后变成$100 \times 32$ 大小。再将图片传入到网络模型当中，进行不断卷积，每一个特征图（Feature Maps）对应一个感受野（Receptice Field）。</p>
<p>循环层的工作，是将在每一个时刻，将一个特征图传入到RNN中。</p>
<p>RNN采用的是LSTM|，解决的是梯度消失问题，并且LSTM是双向的，容易预测具体的行为。例如这样的一句话：我的手机坏了，我想要XX新手机。对于这一句话，如果是单向的话，那么从前往后，只能得到一个“我的手机坏了”，这一个信息，而在后半段前面部分的“我想要”这里，无法判断是需要修手机还是买手机。而双向从后往前，先得到“新手机”这一个信息，因此能够推断出是需要买一个新手机。</p>
<p>对于标签概率分布，则是每一列的概率加起来为1。例如第一个时刻，分别预测a-z可能的概率，所有情况加起来为1。将预测结果全部转化成一个字符串序列。</p>
<p>转录层的工作，这里使用了Lexicon-based，也就是对于每一个预测使用例的输出，都进行了一定限制，只能在固定的label序列中进行选择，相当于有一个拼写检查的过程，使得准确率更加高。例如a-z识别，需要在前面加入一个空白符。$\pi=—hh-e-l-ll-oo—$ 这种情况，相邻相同只取一个，去掉空字符，最后可以得到的$B(\pi)=hello$ 结果。并且不止只有一条路径为hello，可能很多条，需要把所有路径概率加起来，其中每条路径概率为所有选取空格概率乘积。</p>
<script type="math/tex; mode=display">即\rho('hello'|y)=\sum_{\pi:\beta(\pi)='hello'}\rho(\pi|y) ，这种情况</script><p>最后可以得到一个推而广之的公式：</p>
<script type="math/tex; mode=display">\rho(l|y)=\sum_{\pi:\beta(\pi)=l}\rho(\pi|y)  \qquad  \qquad (3-1)</script><p>然后是代码的一些实现，在下方的函数传入中，可以看到几个参数。其中，imgH为图片的高度；nc代表了输入图片通道数。如果是灰度图，那么只有一个通道，为单通道。如果是RGB，那么有三种颜色来描述，即为三通道；nclass为分类数目，例如需要识别a-z，再加上一个空白符；nh为隐藏神经元节点个数，通常设置为256；leakyRelu代表是否使用leakyRelu激活函数，这里不进行使用了。</p>
<p><code>def __init__(self, imgH, nc, nclass, nh, leakyRelu=False):</code></p>
<p>这里尺寸的计算为以下的公式：</p>
<script type="math/tex; mode=display">W=\frac{W+2P-K}{S}+1,H=\frac{H+2P-K}{S}+1</script><p>接下来，即是对图片进行卷积操作，卷积过程如下图所示：</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131648268.png" alt="图3.24  卷积过程"></p>
<p>之后是LSRM类，在这里nIn为神经元个数，nHidden设置为256，bidirection设置为True代表采用双向结构。</p>
<p><code>self.rnn = nn.LSTM(nIn, nHidden, bidirectional=True)</code></p>
<h1 id="训练及运行"><a href="#训练及运行" class="headerlink" title="训练及运行"></a>训练及运行</h1><h2 id="训练"><a href="#训练" class="headerlink" title="训练"></a>训练</h2><p>对于一个深度学习的项目来说，训练是不可少的一步工作。首先，需要一张显卡，建议最低要求是GTX960，显卡越好，训练的速度越快，时间也可以得到大大的缩短，因此在本项目中，我们选取的是GTX30系显卡中的GTX3060版。</p>
<p>需要在训练的相关模块中，加入数据集的信息，确保数据集能够载入。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">train_txt_file=os.path.join(base_dir,<span class="string">r&#x27;D:/Code/Python/invoice/VOC2007/ImageSets/Main/train.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">val_txt_file=os.path.join(base_dir,<span class="string">r&#x27;D:/Code/Python/invoice/VOC2007/ImageSets/Main/val.txt)</span></span><br></pre></td></tr></table></figure>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131649044.png" alt="图4.1  训练过程"></p>
<p>我们可以看到，这里一共是5011个数据集，一共是29轮的训练周期，图片中为第一个周期的第2809张图片的训练片段，可以看到，这里loss损失为0.09左右，还需要进行优化，降低loss才可以。</p>
<p>为了保证训练过程中，不因为外部因素而产生中断的结果，这里需要编写中断保存的功能，即在每一个周期结束之后，进行保存，这样可以保存上一个已经结束的周期，然后将模型的信息进行更改，这样下次进行训练的是否，就会从中断的位置再开始了。但是对于一个周期内运行的进度，则会丢失，导致该周期训练的图片，需要从头开始运行。因此建议一个周期训练完整结束之后，再进行保存操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if epoch % 30 == 0 and epoch != 0:  # 保存模型</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> epoch != <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">     torch.save(model.state_dict(), os.path.join(config.checkpoints_dir, <span class="string">&#x27;ctpn_&#x27;</span> + <span class="built_in">str</span>(epoch) + <span class="string">&#x27;.pth&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>最开始，我们的这个项目，花费了300个小时，但是最后训练模型效果并不理想，在寻找原因最后，得出结论，应当是训练的数据集产生了问题。于是又对数据集进行了图像处理，增加了图像的多样性。然后再一次进行训练，这次训练花费10小时，loss损失降低到了可控的范围之内。</p>
<h2 id="模型加载"><a href="#模型加载" class="headerlink" title="模型加载"></a>模型加载</h2><p>训练完毕之后，会产生多个pth格式的文件，将这些文件放在指定的模型存放位置即可。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131653859.png" alt="图4.2  模型存放"></p>
<h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><p>在Pycharm中，选中主程序，点击右上角的运行按钮进行运行。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131653050.png" alt="图4.3  运行"></p>
<p>可以看到，在终端中，开始输出识别的结果，识别出我们需要的信息。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131653432.png" alt="图4.4  输出识别结果"></p>
<p>这里关于识别对象的选取，首先是13个增值税发票，此处的发票为日常出行的记录，然后又加入了一些通用文字的测试。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131654455.png" alt="图4.5  识别对象"></p>
<h3 id="输出增值税发票识别结果"><a href="#输出增值税发票识别结果" class="headerlink" title="输出增值税发票识别结果"></a>输出增值税发票识别结果</h3><p>在识别结果中，可以看出，识别结果大致都保持在80%以上，结果的效果还是可以的。不过，对于一些带有特殊字符的地方，识别结果可能会徘徊在60-70%这个区间，甚至说，会降低到60%以下的情况，而这些识别精度较低的区域，并不是一张发票的有效信息，我们所需要的信息，在上方与中间，此处的识别准确率较好。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131654433.png" alt="图4.6  发票识别"></p>
<p>在识别测试之后，将识别结果中的txt数据进行读取，然后将其写入到表格当中，便于数据的获取。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131655108.png" alt="图4.7  输出到表格"></p>
<h3 id="输出银行卡识别结果"><a href="#输出银行卡识别结果" class="headerlink" title="输出银行卡识别结果"></a>输出银行卡识别结果</h3><p>用此模型，进行了额外的测试，由于发票通常是和银行卡一块配合使用的。因此，用这个模型，对银行卡进行了识别的测试。可以看到，对于一些色块分布较为明显的地方，识别准确率基本维持在90%以上。而某处，红蓝色块的交替，导致了识别结果会降低到70%左右的程度。</p>
<p><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131655258.png" alt="图4.8  银行卡识别"></p>
<h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>本项目先利用CTPN网络识别发票的文本区域，随后把文本区域输入CRNN网络，以做免分割的端到端鉴别，克服了传统字符分割上的困难，最终实验准确率达90% 左右，响应时间为100 ms 左右，效果良好，达到了预期目标。</p>
<p>在中期的训练问题上，花费了一些时间，一开始选取了中文数据集进行训练，在得到一个模型之后，应用于项目之中，但是在使用的是否，遇到了效果不佳的情况，遂而改变数据集，选用VOC比赛所使用的数据集进行训练，识别结果相对于前者来说，有不错的提高。另外一个问题，就是训练时间过长，也导致了效果的不理想，这一点主要是由于数据集单一导致的，建议在数据集选取上，尽可能选取不同内容数据集，这样才能使得最终效果有明显的提升，也能有效缩短训练时间。</p>
<p>本项目后期识别结果，大部分在预期之中，但是少量情况，识别精度较为底下，并不能准确识别出来，导致结果是一些无法判断的字符，或者会产生残缺等问题，因此，本项目的一些不足之处，还需要在日后的学习当中，再进行优化处理。</p>
<h1 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h1><p>感谢杜兰老师，在过去垂青于我，给了我机会，使我能够接触到视觉学习领域的知识，在过去的时间里，跟着杜老师，完成了省创和校创的项目，并且参与了学校毕业设计的金种子项目。同时，感佩杜老师，在交流过程中，学术功力的强大之处，能否在前期为我的学习指明道路，引导我不断学习。同时，杜老师和蔼可亲，因材施教，沐风栉雨的风格，让我在学习当中，如沐春风。杜老师真可称为一位负责任，有耐心的好老师，无以为报，再次感谢。</p>
<p>弹指一挥二十载，如今已是毕业人。莫问前程在何处，路在脚下走便是。</p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ol>
<li>左捷.推行增值税电子专用发票的思考[J].知识经济,2020(12):36-37.</li>
<li>邵慧敏,张太红.基于CTPN神经网络对营业执照文字检测模型[J].计算机技术与发展, 31(01):94-97.</li>
<li>朱莉莉,刘芳芳.浅谈现代通信技术及其发展趋势[J].电脑知识与技术,2013,9(11):2584-2585+2588.</li>
<li>辜双佳,栗智.基于CRNN模型的中文场景文字识别[J].科技风,2021(17):108-110.</li>
<li>刘艳菊,伊鑫海,李炎阁,等.深度学习在场景文字识别技术中的应用综述[J].计算机工程与应用,2022,58(04):52-63.</li>
<li>王栋.人工智能OCR技术的应用研究[J].电子技术与软件工程,2022(01):122-125.</li>
<li>刘丹,王少康,张同社. 一种图像分层压缩方法及图像分层压缩装置[P]. 北京市：CN113365071A,2021-09-07.</li>
<li>付童. 端到端的自然场景文字检测与识别研究[D].北京:北京交通大学,2020.</li>
<li>张正夫. 基于深度学习的场景文字检测与识别方法研究[D]. 北京:中国科学院大学(中国科学院深圳先进技术研究院),2020.</li>
<li>白志程,李擎,陈鹏,等.自然场景文本检测技术研究综述[J].工程科学学报,2020,42(11):1433-1448.</li>
<li>杨捷,刘进锋.利用CTPN检测电影海报中的文本信息[J].电脑知识与术,2018,14(25):213-215.</li>
<li>孙光民,关世奎,李煜,等.基于改进CTPN算法的试卷手写文本检测[J].信息术,2020,44(09):94-98.</li>
<li>王之博,赵双明.基于Mask R-CNN的道路交通标志识别[J/OL].测绘地理信息:1-4[2022-05-18].</li>
<li>程学军,邢萧飞.利用改进型VGG标签学习的表情识别方法[J].计算机工程与计,2022,43(04):1134-1144.</li>
<li>马森标,唐卫明,陈春强.LSTM优化模型的水库水位预测研究[J].福建电脑,2022,38(05):1-8.</li>
<li>王卫中,周铭辉,李丹丹.CT联合CTC检测对GGO患者早期肺癌的诊断价值[J].中国CT和MRI杂志,2022,20(01):71-72+115.</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://yuzhang.wang">YuZhangWang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://yuzhang.wang/139-invoice-identification/">https://yuzhang.wang/139-invoice-identification/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://yuzhang.wang" target="_blank">YuZhangWang的领域</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CRNN/">CRNN</a><a class="post-meta__tags" href="/tags/CTPN/">CTPN</a><a class="post-meta__tags" href="/tags/%E5%A2%9E%E5%80%BC%E7%A8%8E%E5%8F%91%E7%A5%A8/">增值税发票</a></div><div class="post-share"><div class="social-share" data-image="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309131534293.png" data-sites="wechat,qq,weibo"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/04/18/20220418195242695.jpg" target="_blank"><img class="post-qr-code-img" src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/04/18/20220418195242695.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/04/18/20220418195556282.png" target="_blank"><img class="post-qr-code-img" src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/04/18/20220418195556282.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="prev-post pull-left" href="/142-note-tag/" title="Butterfly中Note标签使用方法"><img class="cover" src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202310141208712.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Butterfly中Note标签使用方法</div></div></a><a class="next-post pull-right" href="/138-prohibited-drugs/" title="关于麻醉药及违禁药在抑郁症快速起效领域应用情况的调查研究"><img class="cover" src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309071148969.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">关于麻醉药及违禁药在抑郁症快速起效领域应用情况的调查研究</div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a href="/105-opening-report/" title="开题报告"><img class="cover" src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202208070531940.jpg?source=1940ef5c" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2022-08-07</div><div class="title">开题报告</div></div></a><a href="/106-translation/" title="外文翻译"><img class="cover" src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures01@master/img/202203102131655.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-08-14</div><div class="title">外文翻译</div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info is-center"><div class="avatar-img"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202210171416164.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">YuZhangWang</div><div class="author-info-description">PLUSULTRA!</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">139</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">288</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://yuzhang-wang.translate.goog/?_x_tr_sl=zh-CN&amp;_x_tr_tl=en&amp;_x_tr_hl=zh-CN&amp;_x_tr_pto=wapp"><i class="fa-solid fa-earth-americas"></i><span>English Version Blog</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:YuZhangWang233@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://github.com/YuZhangWang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://space.bilibili.com/19474542" target="_blank" title="bilibili"><i class="fab fa-bilibili" style="color: #FB7299;"></i></a><a class="social-icon" href="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative_pictures01@main/2021/03/09/mmqrcode1615295634051.png" target="_blank" title="WeChat"><i class="fab fa-weixin" style="color: #199D18;"></i></a><a class="social-icon" href="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative_pictures01@main/2021/03/09/qrcode_1615295622746.jpg" target="_blank" title="QQ"><i class="fab fa-qq" style="color: #4AABE7;"></i></a><a class="social-icon" href="https://yuzhang.wang/rss2.xml" target="_blank" title="RSS"><i class="fa-solid fa-rss" style="color: #F99C36;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">1.视频发布于B站，文章发布于博客</br> 2.待修复bug:无</br> 3.待优化地方:无</br></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%AA%E8%AE%BA"><span class="toc-number">1.</span> <span class="toc-text">绪论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E9%A2%98%E7%9A%84%E7%A0%94%E7%A9%B6%E8%83%8C%E6%99%AF%E5%8F%8A%E6%84%8F%E4%B9%89"><span class="toc-number">1.1.</span> <span class="toc-text">课题的研究背景及意义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OCR%E7%A0%94%E7%A9%B6%E8%BF%9B%E5%B1%95"><span class="toc-number">1.2.</span> <span class="toc-text">OCR研究进展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E6%A3%80%E6%B5%8B%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.1.</span> <span class="toc-text">文本检测方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E8%AF%86%E5%88%AB%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.2.</span> <span class="toc-text">文本识别方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.3.</span> <span class="toc-text">端到端的方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BA%E6%96%87%E7%9A%84%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9%E5%8F%8A%E7%BB%93%E6%9E%84%E5%AE%89%E6%8E%92"><span class="toc-number">1.3.</span> <span class="toc-text">论文的主要内容及结构安排</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%90%86%E8%AE%BA%E5%8F%8A%E6%8A%80%E6%9C%AF%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">相关理论及技术介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C"><span class="toc-number">2.1.</span> <span class="toc-text">卷积神经网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C"><span class="toc-number">2.2.</span> <span class="toc-text">循环神经网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CTPN%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%AE%80%E4%BB%8B"><span class="toc-number">2.3.</span> <span class="toc-text">CTPN神经网络简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRNN%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84%E8%AF%86%E5%88%AB"><span class="toc-number">2.4.</span> <span class="toc-text">CRNN端到端的识别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CRNN%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">2.4.1.</span> <span class="toc-text">CRNN的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRNN%E7%9A%84%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84"><span class="toc-number">2.4.2.</span> <span class="toc-text">CRNN的网络结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CTC%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.4.3.</span> <span class="toc-text">CTC模型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90%E5%8F%8A%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.</span> <span class="toc-text">系统分析及总体设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%80%BC%E7%A8%8E%E5%8F%91%E7%A5%A8%E8%87%AA%E5%8A%A8%E8%AF%86%E5%88%AB%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90"><span class="toc-number">3.1.</span> <span class="toc-text">增值税发票自动识别系统分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%80%BC%E7%A8%8E%E5%8F%91%E7%A5%A8%E8%87%AA%E5%8A%A8%E8%AF%86%E5%88%AB%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.2.</span> <span class="toc-text">增值税发票自动识别算法设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.1.</span> <span class="toc-text">系统环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86%E5%8A%A0%E8%BD%BD"><span class="toc-number">3.2.2.</span> <span class="toc-text">数据集加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E5%AD%97%E6%A3%80%E6%B5%8B%E7%BD%91%E7%BB%9C"><span class="toc-number">3.2.3.</span> <span class="toc-text">文字检测网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E5%AD%97%E8%AF%86%E5%88%AB%E7%BD%91%E7%BB%9C"><span class="toc-number">3.2.4.</span> <span class="toc-text">文字识别网络</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83%E5%8F%8A%E8%BF%90%E8%A1%8C"><span class="toc-number">4.</span> <span class="toc-text">训练及运行</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83"><span class="toc-number">4.1.</span> <span class="toc-text">训练</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E5%8A%A0%E8%BD%BD"><span class="toc-number">4.2.</span> <span class="toc-text">模型加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="toc-number">4.3.</span> <span class="toc-text">运行结果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%A2%9E%E5%80%BC%E7%A8%8E%E5%8F%91%E7%A5%A8%E8%AF%86%E5%88%AB%E7%BB%93%E6%9E%9C"><span class="toc-number">4.3.1.</span> <span class="toc-text">输出增值税发票识别结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E9%93%B6%E8%A1%8C%E5%8D%A1%E8%AF%86%E5%88%AB%E7%BB%93%E6%9E%9C"><span class="toc-number">4.3.2.</span> <span class="toc-text">输出银行卡识别结果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-number">5.</span> <span class="toc-text">结论</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%B4%E8%B0%A2"><span class="toc-number">6.</span> <span class="toc-text">致谢</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">7.</span> <span class="toc-text">参考文献</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/142-note-tag/" title="Butterfly中Note标签使用方法"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202310141208712.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Butterfly中Note标签使用方法"/></a><div class="content"><a class="title" href="/142-note-tag/" title="Butterfly中Note标签使用方法">Butterfly中Note标签使用方法</a><time datetime="2024-10-08T16:21:57.101Z" title="更新于 2024-10-09 00:21:57">2024-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/001-obsidian-template/" title="无标题"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/04/18/20220418195159290.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无标题"/></a><div class="content"><a class="title" href="/001-obsidian-template/" title="无标题">无标题</a><time datetime="2024-07-09T12:21:49.328Z" title="更新于 2024-07-09 20:21:49">2024-07-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/028-synchronization-strategy/" title="炉石的同步策略"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures01@main/img/20210826222306.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="炉石的同步策略"/></a><div class="content"><a class="title" href="/028-synchronization-strategy/" title="炉石的同步策略">炉石的同步策略</a><time datetime="2023-10-18T00:26:24.693Z" title="更新于 2023-10-18 08:26:24">2023-10-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/027-new-function/" title="一加新功能"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/08/07/20220807043237906.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一加新功能"/></a><div class="content"><a class="title" href="/027-new-function/" title="一加新功能">一加新功能</a><time datetime="2023-10-18T00:26:17.338Z" title="更新于 2023-10-18 08:26:17">2023-10-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/114-defense-experience/" title="导师给的答辩经验"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202208070536934.7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="导师给的答辩经验"/></a><div class="content"><a class="title" href="/114-defense-experience/" title="导师给的答辩经验">导师给的答辩经验</a><time datetime="2023-10-18T00:25:28.166Z" title="更新于 2023-10-18 08:25:28">2023-10-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/133-best-template/" title="你应该为自己创建一个Github仓库模板"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309012124695.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="你应该为自己创建一个Github仓库模板"/></a><div class="content"><a class="title" href="/133-best-template/" title="你应该为自己创建一个Github仓库模板">你应该为自己创建一个Github仓库模板</a><time datetime="2023-10-11T01:56:16.186Z" title="更新于 2023-10-11 09:56:16">2023-10-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="footer_custom_text"><div class="footer_custom_text"><div class="coin-title"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309032153357.png" data-lazy-src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202309032153357.png" alt="Moe" style="height:1.3em" data-ll-status="loaded" class="entered loaded">&nbsp;萌ICP备<a href="https://icp.gov.moe/?keyword=20238869" target="_blank">20238869</a>号&nbsp;<i class="fa-fw fas fa-duotone fa-cat"></i>&nbsp;<a href="https://github.com/YuZhangWang" target="_blank">YuZhangWang</a>&nbsp;©2019-Present</div><div class="coin-title">Powered By&nbsp;<a href="https://hexo.io/zh-cn/index.html" target="_blank">Hexo</a>&nbsp;|&nbsp;Theme By&nbsp;<a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank">Butterfly</a></div><div class="coin-title"><a href="https://qwerty.kaiyi.cool/" target="_blank" alt="qwerty-learner" rel="nofollow"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202305131945636.png" data-lazy-src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202305131945636.png" alt="qwerty-learner" style="height:1.3em" data-ll-status="loaded" class="entered loaded"></a>&nbsp;<a target="_blank" rel="noopener" href="https://blogwe.com/"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/04/18/20220418195801782.jpg" data-lazy-src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/04/18/20220418195801782.jpg" alt="博客大全" style="height:1.3em" data-ll-status="loaded" class="entered loaded"></a>&nbsp;<a target="_blank" rel="noopener" href="https://vim-adventures.com/"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/04/18/20220418195910376.jpg" data-lazy-src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/04/18/20220418195910376.jpg" alt="vim-adventures" style="height:1.3em" data-ll-status="loaded" class="entered loaded"></a>&nbsp;<a target="_blank" rel="noopener" href="https://huanghaibin91.github.io/Reversi/"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/04/18/20220418200005401.png" data-lazy-src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02/2022/04/18/20220418200005401.png" alt="黑白翻转棋" style="height:1.3em" data-ll-status="loaded" class="entered loaded"></a>&nbsp;<a target="_blank" rel="noopener" href="https://cloud.tencent.com/"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures01@main/img/20210826081712.svg" data-lazy-src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures01@main/img/20210826081712.svg" alt="腾讯云" style="height:1.3em" data-ll-status="loaded" class="entered loaded"></a>&nbsp;<a target="_blank" rel="noopener" href="https://www.jsdelivr.com"><img src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202305131843411.png" data-lazy-src="https://gcore.jsdelivr.net/gh/YuZhangWang/Creative-pictures02@master/img/202305131843411.png" alt="Jsdelivr" style="height:1.3em" data-ll-status="loaded" class="entered loaded"></a></div></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>(() => {
  const panguFn = () => {
    if (typeof pangu === 'object') pangu.autoSpacingPage()
    else {
      btf.getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
        .then(() => {
          pangu.autoSpacingPage()
        })
    }
  }

  const panguInit = () => {
    if (false){
      GLOBAL_CONFIG_SITE.isPost && panguFn()
    } else {
      panguFn()
    }
  }

  btf.addGlobalFn('pjaxComplete', panguInit, 'pangu')
  document.addEventListener('DOMContentLoaded', panguInit)
})()</script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }
      
      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(()=>{
  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const loadGiscus = () => {
    const config = Object.assign({
      src: 'https://giscus.app/client.js',
      'data-repo': 'YuZhangWang/YuZhangWang.github.io',
      'data-repo-id': 'MDEwOlJlcG9zaXRvcnkzNDY4MTQyNjE=',
      'data-category-id': 'DIC_kwDOFKv3Nc4CQ6NC',
      'data-mapping': 'pathname',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true
    },{"data-mapping":"title","data-strict":1,"data-reactions-enabled":1,"data-emit-metadata":0,"data-input-position":"top","data-lang":"zh-CN"})

    const ele = document.createElement('script')
    for (let key in config) {
      ele.setAttribute(key, config[key])
    }
    document.getElementById('giscus-wrap').appendChild(ele)
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment= loadGiscus
  }
})()</script></div><script>document.addEventListener('visibilitychange', function () {if (document.visibilityState == 'hidden') {normal_title = document.title;document.title = '早上好 中午好 晚上好';}else document.title = normal_title;});</script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://yuzhang.wang/categories/学术研究/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🎓 Academic Research (15)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://yuzhang.wang/categories/项目展示/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💎 Project Showcase (16)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://yuzhang.wang/categories/Python学习笔记/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📖 Python Learning Notes (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://yuzhang.wang/categories/CV学习笔记/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💻 CV Learning Notes (9)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://yuzhang.wang/categories/C-学习笔记/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📖 C++ Learning Notes (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://yuzhang.wang/categories/数据结构学习笔记/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💻 Data Structures Learning Notes (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://yuzhang.wang/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: rgb(127, 199, 244)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>function history_calendar_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>历史上的今天</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
                console.log('已挂载history_calendar')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='/'|| '/' ==='all')){

            history_calendar_injector_config()
        } </script><script data-pjax  src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>